<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trusted Store - সব পণ্য</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@rive-app/canvas@2.10.3"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body {
            font-family: 'Hind Siliguri', sans-serif;
            padding-bottom: 80px;
            -webkit-tap-highlight-color: transparent;
        }

        .theme-bg {
            background-color: #006D5B;
        }

        .theme-text {
            color: #006D5B;
        }

        .category-active {
            background-color: #006D5B !important;
            color: white !important;
            border-color: #006D5B !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #006D5B;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <!-- Meta Pixel Code -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }

        !function (f, b, e, v, n, t, s) {
            if (f.fbq) return; n = f.fbq = function () {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
            n.queue = []; t = b.createElement(e); t.async = !0;
            t.src = v; s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1505904560492063');
        fbq('track', 'PageView');
        dataLayer.push({ 'event': 'page_view' });
    </script>
    <noscript><img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id=1505904560492063&ev=PageView&noscript=1" /></noscript>
    <!-- End Meta Pixel Code -->
</head>

<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">

    <nav class="bg-white shadow-sm sticky top-0 z-40 border-b border-gray-100">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2 group">
                <div class="bg-white p-1 rounded-full border border-gray-200">
                    <img src="assests/logo.png" alt="Logo" class="w-8 h-8 md:w-10 md:h-10">
                </div>
                <div>
                    <span class="block text-lg md:text-xl font-bold leading-none theme-text">TRUSTED</span>
                    <span class="block text-[10px] md:text-xs font-bold text-gray-400 tracking-wider">Online
                        STORE</span>
                </div>
            </a>
            <div class="hidden md:flex items-center gap-6">
                <a href="index.html" class="font-bold text-gray-600 hover:text-[#006D5B] transition">হোম</a>
            </div>
        </div>
    </nav>
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-6 md:py-10 fade-in min-h-[60vh]">
        <!-- Header & Search -->
        <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800"><i class="fas fa-boxes text-[#006D5B] mr-2"></i>সকল
                পণ্য <span id="showing-count" class="text-lg text-gray-500 font-medium ml-2">(0)</span></h1>

            <div class="w-full md:w-96 relative">
                <input type="text" id="search-input" oninput="filterProducts()" placeholder="পণ্য খুঁজুন..."
                    class="w-full pl-10 pr-4 py-3 rounded-full border border-gray-200 focus:border-[#006D5B] focus:ring-2 focus:ring-[#006D5B]/20 outline-none transition shadow-sm">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
        </div>

        <!-- Categories -->
        <div class="flex gap-3 overflow-x-auto pb-4 mb-6 scrollbar-hide">
            <button onclick="filterByCategory('all')"
                class="category-btn whitespace-nowrap px-6 py-2 rounded-full font-bold text-sm transition category-active ring-1 ring-[#006D5B]">সব</button>
            <button onclick="filterByCategory('mushroom')"
                class="category-btn whitespace-nowrap px-6 py-2 rounded-full font-bold text-sm bg-white text-gray-600 border border-gray-200 hover:border-[#006D5B] hover:text-[#006D5B] transition">মাশরুম</button>
            <button onclick="filterByCategory('cosmetics')"
                class="category-btn whitespace-nowrap px-6 py-2 rounded-full font-bold text-sm bg-white text-gray-600 border border-gray-200 hover:border-[#006D5B] hover:text-[#006D5B] transition">কসমেটিকস</button>
            <button onclick="filterByCategory('supplements')"
                class="category-btn whitespace-nowrap px-6 py-2 rounded-full font-bold text-sm bg-white text-gray-600 border border-gray-200 hover:border-[#006D5B] hover:text-[#006D5B] transition">সাপ্লিমেন্ট</button>
            <button onclick="filterByCategory('daily')"
                class="category-btn whitespace-nowrap px-6 py-2 rounded-full font-bold text-sm bg-white text-gray-600 border border-gray-200 hover:border-[#006D5B] hover:text-[#006D5B] transition">নিত্যপ্রয়োজনীয়</button>
        </div>

        <!-- Grid -->
        <canvas id="grid-loader" width="50" height="50" class="mx-auto my-5"></canvas>
        <div id="all-products-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6 hidden">
            <!-- Items injected by JS -->
        </div>
        <div id="no-products-msg" class="hidden text-center py-20">
            <div class="text-gray-300 mb-4"><i class="fas fa-search text-6xl opacity-20"></i></div>
            <h3 class="text-xl font-bold text-gray-500">কোন পণ্য পাওয়া যায়নি</h3>
            <p class="text-gray-400">অন্য কিছু লিখে অনুসন্ধান করুন</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black text-gray-400 py-12 border-t border-gray-800 mt-auto">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="space-y-4">
                    <a href="#" class="flex items-center gap-2 mb-4">
                        <div class="bg-white p-1 rounded-full"><img src="assests/logo.png" class="w-8 h-8"></div>
                        <div>
                            <span class="block text-xl font-bold text-white leading-none">TRUSTED</span>
                            <span class="block text-xs font-bold text-gray-500">Online STORE</span>
                        </div>
                    </a>
                    <div>
                        <h4 class="text-white font-bold mb-1 text-sm"><i class="fas fa-phone-alt mr-2"></i> Phone Number
                        </h4>
                        <p class="text-sm">01567-884423</p>
                    </div>
                </div>
                <div>
                    <h3 class="text-white font-bold mb-6 text-sm tracking-wider">LOCATION</h3>
                    <ul class="space-y-5 text-sm">
                        <li class="flex gap-3">
                            <i class="fas fa-map-marker-alt text-orange-500 mt-1"></i>
                            <div>
                                <span class="block font-bold text-gray-300">Dhaka , Mirpur, Bangladesh</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div
                class="border-t border-gray-800 mt-12 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500">
                <p>&copy; 2025 Trusted Store.</p>
            </div>
        </div>
    </footer>

    <!-- Mobile Bottom Nav -->
    <div
        class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 shadow-[0_-5px_10px_rgba(0,0,0,0.05)] z-50 md:hidden pb-safe">
        <div class="grid grid-cols-4 h-16 items-center">
            <a href="index.html"
                class="flex flex-col items-center justify-center text-gray-500 hover:text-[#006D5B] gap-1 btn-press"><i
                    class="fas fa-home text-xl"></i><span class="text-[10px] font-medium">হোম</span></a>
            <a href="products.html" class="flex flex-col items-center justify-center text-[#006D5B] gap-1 btn-press"><i
                    class="fas fa-search text-xl"></i><span class="text-[10px] font-bold">খুঁজুন</span></a>
            <button onclick="toggleCart()"
                class="flex flex-col items-center justify-center text-gray-500 hover:text-[#006D5B] gap-1 relative btn-press">
                <div class="relative"><i class="fas fa-shopping-bag text-xl"></i><span id="mobile-cart-badge"
                        class="absolute -top-2 -right-2 bg-red-500 text-white text-[9px] font-bold h-4 w-4 flex items-center justify-center rounded-full border border-white">0</span>
                </div><span class="text-[10px] font-medium">ব্যাগ</span>
            </button>
            <a href="contact.html"
                class="flex flex-col items-center justify-center text-gray-500 hover:text-[#006D5B] gap-1 btn-press"><i
                    class="fas fa-user text-xl"></i><span class="text-[10px] font-medium">অ্যাকাউন্ট</span></a>
        </div>
    </div>

    <div id="mini-sticky-cart" onclick="toggleCart()"
        class="fixed bottom-20 md:bottom-6 right-4 md:right-6 bg-[#006D5B] text-white pl-4 pr-6 py-3 rounded-full shadow-2xl flex items-center gap-4 cursor-pointer hover:scale-105 transition duration-300 z-40 opacity-0 translate-y-10 border-2 border-white/20">
        <div class="relative bg-white/10 p-2 rounded-full"><i class="fas fa-shopping-basket text-xl"></i><span
                id="sticky-count"
                class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold h-5 w-5 flex items-center justify-center rounded-full border border-[#006D5B]">0</span>
        </div>
        <div class="flex flex-col items-start leading-tight"><span
                class="text-[10px] text-green-100 font-bold uppercase tracking-wider">মোট</span><span id="sticky-total"
                class="font-bold text-lg">৳0</span></div>
    </div>

    <div id="cart-overlay" onclick="toggleCart()"
        class="fixed inset-0 bg-black bg-opacity-60 z-[60] hidden transition-opacity duration-300 backdrop-blur-sm">
    </div>
    <div id="cart-drawer"
        class="fixed top-0 right-0 h-full w-[85%] md:w-[400px] bg-white z-[70] shadow-2xl transform translate-x-full flex flex-col">
        <div class="p-4 theme-bg text-white flex justify-between items-center shadow-md">
            <h3 class="font-bold text-lg">আপনার ব্যাগ</h3><button onclick="toggleCart()"
                class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 text-white"><i
                    class="fas fa-times"></i></button>
        </div>
        <div id="cart-items-container" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50"></div>
        <div class="p-4 bg-white border-t shadow-[0_-5px_15px_rgba(0,0,0,0.05)] pb-safe">
            <div class="flex justify-between items-center mb-3"><span class="text-gray-600 font-medium">মোট
                    বিল</span><span id="drawer-total" class="theme-text font-bold text-xl">৳0</span></div>
            <a href="checkout.html"
                class="block w-full theme-bg text-white text-center py-3.5 rounded-xl font-bold hover:bg-[#005a4b] transition shadow-lg btn-press">অর্ডার
                কনফার্ম করুন</a>
        </div>
    </div>

    <div id="product-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-md transition-opacity" onclick="closeProductModal()">
        </div>
        <div
            class="relative w-full md:w-[95%] lg:w-[1100px] h-[90vh] md:h-auto md:max-h-[90vh] bg-white rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden animate-[scaleUp_0.3s_ease-out]">
            <button onclick="closeProductModal()"
                class="absolute top-4 right-4 z-10 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center md:hidden"><i
                    class="fas fa-times text-gray-500"></i></button>
            <div
                class="w-full md:w-5/12 bg-gray-100 p-4 md:p-10 flex flex-col justify-center relative items-center shrink-0">
                <div
                    class="w-full h-[220px] md:h-[400px] bg-white rounded-xl overflow-hidden shadow-sm border border-gray-200 flex items-center justify-center p-4">
                    <img id="modal-img-main" src="" class="max-w-full max-h-full object-contain">
                </div>
                <div class="flex gap-3 justify-start md:justify-center mt-4 md:mt-6 overflow-x-auto w-full px-2 scrollbar-hide"
                    id="modal-thumbnails"></div>
            </div>
            <div
                class="w-full md:w-7/12 p-5 md:p-12 flex flex-col flex-1 min-h-0 overflow-y-auto custom-scrollbar relative">
                <div class="flex justify-between items-start mb-3">
                    <span id="modal-cat"
                        class="text-xs font-bold text-[#006D5B] bg-[#006D5B]/10 px-3 py-1 rounded-full uppercase tracking-wider">Category</span>
                    <button onclick="closeProductModal()"
                        class="hidden md:flex w-10 h-10 hover:bg-gray-100 rounded-full items-center justify-center transition duration-300 transform hover:rotate-90"><i
                            class="fas fa-times text-gray-400 text-lg"></i></button>
                </div>
                <h2 id="modal-title" class="text-2xl md:text-4xl font-bold text-gray-800 mb-2 leading-tight font-hind">
                    Product Title</h2>
                <div class="flex items-center gap-3 mb-4">
                    <span id="modal-price" class="text-3xl md:text-4xl font-bold theme-text">৳0</span>
                    <div class="flex flex-col leading-none">
                        <span id="modal-reg-price"
                            class="text-sm md:text-base text-gray-400 line-through hidden">৳0</span>
                        <span id="modal-discount-badge" class="text-red-500 text-xs font-bold hidden">SAVE 20%</span>
                    </div>
                </div>
                <div class="w-full h-px bg-gray-100 mb-4 md:my-6"></div>
                <div class="prose prose-sm md:prose-base text-gray-600 mb-6 flex-1">
                    <p id="modal-desc" class="leading-relaxed whitespace-pre-line text-base">Product description...</p>
                </div>
                <div class="mt-auto pt-2 space-y-3 md:space-y-4 pb-2">
                    <button id="modal-add-btn"
                        class="w-full theme-bg text-white py-4 rounded-xl font-bold hover:bg-[#005a4b] transition shadow-lg hover:shadow-xl flex items-center justify-center gap-3 text-lg btn-press transform active:scale-95 duration-200"><i
                            class="fas fa-shopping-bag"></i> কার্টে যোগ করুন</button>
                    <div
                        class="grid grid-cols-2 gap-4 text-xs font-bold text-gray-500 bg-gray-50 p-4 rounded-lg border border-gray-100">
                        <span class="flex items-center gap-2"><i class="fas fa-shield-alt text-[#006D5B] text-lg"></i>
                            <div>
                                <p class="text-gray-800">100% জেনুইন</p>
                                <p class="font-normal text-[10px]">অরিজিনাল প্রোডাক্ট</p>
                            </div>
                        </span>
                        <span class="flex items-center gap-2"><i class="fas fa-truck text-[#006D5B] text-lg"></i>
                            <div>
                                <p class="text-gray-800">দ্রুত ডেলিভারি</p>
                                <p class="font-normal text-[10px]">সারা বাংলাদেশে</p>
                            </div>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scriptURL =
            'https://script.google.com/macros/s/AKfycbwzAFmcBJZNoii1G7pQZ2lPFBRQ-vRgdm872Wx9ilAyv5Q6GitmG9XufQJl_zlmxCRb/exec';
        let allProducts = [];
        let currentCategory = 'all';

        async function fetchProducts() {
            try {
                const response = await fetch(scriptURL + '?action=getProducts');
                const data = await response.json();

                // Patch: Generate IDs if missing using product name for consistency
                allProducts = data.map(p => {
                    if (!p.id || p.id === "null") {
                        // Create a simple slug from the name
                        p.id = p.name ? p.name.trim().toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g, '') : 'unknown_' + Math.random().toString(36).substr(2, 9);
                    }
                    return p;
                });

                console.log("All Products Data:", allProducts); // DEBUG: Inspect API response
                if (allProducts.length > 0) {
                    console.log("First Product Keys:", Object.keys(allProducts[0])); // DEBUG: Check keys
                    console.log("First Product ID:", allProducts[0].id); // DEBUG: Check ID specifically
                }
                renderProducts(allProducts);
                // Hide Rive Loader (Canvas remains but we can hide it or stop it)
                const loaderCanvas = document.getElementById('grid-loader');
                if (loaderCanvas) loaderCanvas.classList.add('hidden');

                document.getElementById('all-products-list').classList.remove('hidden');
            } catch (error) { console.error("Error:", error); }
        }

        function renderProducts(products) {
            const container = document.getElementById('all-products-list');
            const noMsg = document.getElementById('no-products-msg');
            container.innerHTML = "";
            document.getElementById('showing-count').innerText = products.length;

            if (products.length === 0) {
                noMsg.classList.remove('hidden');
            } else {
                noMsg.classList.add('hidden');
                products.forEach(product => {
                    const regPrice = product.regular_price || product.price;
                    const discount = Math.round(((regPrice - product.price) / regPrice) * 100);

                    container.innerHTML += `
                <div class="bg-white rounded-xl p-3 md:p-4 shadow-sm border border-gray-100 text-center flex flex-col h-full hover:shadow-lg transition group cursor-pointer"
                    onclick="openProductModal('${product.id}')">
                    <div class="relative aspect-square mb-3 bg-gray-100 rounded-lg overflow-hidden">
                        <img src="${product.img}"
                            class="w-full h-full object-cover group-hover:scale-110 transition duration-500"
                            onerror="this.src='https://placehold.co/150'">
                        ${discount > 0 ? `<span
                            class="absolute top-2 left-2 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow z-10">-${discount}%</span>`
                            : ''}
                        <div
                            class="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                            <span
                                class="bg-white/90 text-gray-800 text-xs font-bold px-3 py-1.5 rounded-full shadow-lg transform translate-y-4 group-hover:translate-y-0 transition"><i
                                    class="fas fa-eye mr-1"></i> দেখুন</span>
                        </div>
                    </div>
                    <h3
                        class="font-bold text-gray-800 text-sm md:text-lg mb-1 line-clamp-2 min-h-[2.5em] group-hover:text-[#006D5B] transition">
                        ${product.name}</h3>
                    <div class="flex justify-center items-center gap-2 mb-3">
                        <span class="theme-text font-bold text-base md:text-xl">৳${product.price}</span>
                        ${discount > 0 ? `<span class="text-xs text-gray-400 line-through">৳${regPrice}</span>` : ''}
                    </div>
                    <button onclick="event.stopPropagation(); addToCart('${product.id}')"
                        class="w-full theme-bg text-white py-2 md:py-2.5 rounded-lg font-bold text-sm md:text-base hover:bg-[#005a4b] transition mt-auto shadow-md relative z-20">অর্ডার
                        করুন</button>
                </div>`;
                });
            }
        }

        // --- Modal Logic ---
        function openProductModal(id) {
            try {
                const p = allProducts.find(x => x.id == id);
                if (!p) return;

                // Pixel ViewContent
                try {
                    if (typeof fbq === 'function') {
                        fbq('track', 'ViewContent', {
                            content_ids: [p.id],
                            content_type: 'product',
                            value: p.price,
                            currency: 'BDT',
                            content_name: p.name
                        });
                        dataLayer.push({
                            'event': 'view_content',
                            'ecommerce': {
                                'items': [{
                                    'item_id': p.id,
                                    'item_name': p.name,
                                    'price': p.price,
                                    'currency': 'BDT'
                                }]
                            }
                        });
                    }
                } catch (e) { console.warn("Pixel Error:", e); }

                document.getElementById('modal-img-main').src = p.img;
                document.getElementById('modal-cat').innerText = p.category ? p.category.replace(/_/g, ' ') : '';
                document.getElementById('modal-title').innerText = p.name;
                document.getElementById('modal-desc').innerText = p.description || 'বিস্তারিত শীঘ্রই আসছে...';
                document.getElementById('modal-price').innerText = '৳' + p.price;

                const regPrice = p.regular_price || p.price;
                const discount = Math.round(((regPrice - p.price) / regPrice) * 100);

                const regEl = document.getElementById('modal-reg-price');
                const badgeEl = document.getElementById('modal-discount-badge');

                if (discount > 0) {
                    if (regEl) { regEl.innerText = '৳' + regPrice; regEl.classList.remove('hidden'); }
                    if (badgeEl) { badgeEl.innerText = `SAVE ${discount}% `; badgeEl.classList.remove('hidden'); }
                } else {
                    if (regEl) regEl.classList.add('hidden');
                    if (badgeEl) badgeEl.classList.add('hidden');
                }

                // Thumbnails
                const thumbs = document.getElementById('modal-thumbnails');
                if (thumbs) {
                    thumbs.innerHTML = '';
                    [p.img, p.img2, p.img3].filter(Boolean).forEach((img, i) => {
                        thumbs.innerHTML += `<img src="${img}" onclick="changeModalImg(this.src)"
                            class="w-14 h-14 md:w-16 md:h-16 rounded-md border border-gray-200 cursor-pointer hover:border-[#006D5B] object-cover transition ${i === 0 ? 'border-[#006D5B] ring-1 ring-[#006D5B]' : ''}">`;
                    });
                }

                const addBtn = document.getElementById('modal-add-btn');
                if (addBtn) addBtn.onclick = () => { addToCart(p.id); closeProductModal(); };

                document.getElementById('product-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } catch (err) { console.error("Modal Error:", err); }
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function changeModalImg(src) {
            document.getElementById('modal-img-main').src = src;
            document.querySelectorAll('#modal-thumbnails img').forEach(img => {
                if (img.src === src) img.classList.add('border-[#006D5B]', 'ring-1', 'ring-[#006D5B]');
                else img.classList.remove('border-[#006D5B]', 'ring-1', 'ring-[#006D5B]');
            });
        }

        function filterProducts() {
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const filtered = allProducts.filter(p => {
                const matchesName = p.name.toLowerCase().includes(searchText);
                const matchesCat = currentCategory === 'all' || p.category.toLowerCase() ===
                    currentCategory.toLowerCase();
                return matchesName && matchesCat;
            });


            // Pixel Search (if query exists)
            if (searchText.length > 1) {
                try {
                    if (typeof fbq === 'function') {
                        fbq('track', 'Search', { search_string: searchText });
                        dataLayer.push({
                            'event': 'search',
                            'search_term': searchText
                        });
                    }
                } catch (e) { console.warn("Pixel Error:", e); }
            }

            renderProducts(filtered);
        }

        function filterByCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('category-active',
                'bg-[#006D5B]', 'text-white'));
            event.target.classList.add('category-active', 'bg-[#006D5B]', 'text-white');
            filterProducts();
        }

        // Cart Logic (Unchanged)
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        updateCartUI();

        function addToCart(id) {
            console.log("addToCart called with ID:", id); // DEBUG
            try {
                const product = allProducts.find(p => p.id == id);
                console.log("Product found:", product); // DEBUG
                if (product) {
                    cart.push(product);
                    // Pixel AddToCart
                    try {
                        if (typeof fbq === 'function') {
                            fbq('track', 'AddToCart', {
                                content_ids: [product.id],
                                content_type: 'product',
                                value: product.price,
                                currency: 'BDT',
                                content_name: product.name
                            });
                            dataLayer.push({
                                'event': 'add_to_cart',
                                'ecommerce': {
                                    'items': [{
                                        'item_id': product.id,
                                        'item_name': product.name,
                                        'price': product.price,
                                        'currency': 'BDT'
                                    }]
                                }
                            });
                        }
                    } catch (e) { console.warn("Pixel Error:", e); }

                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartUI();

                    if (typeof Swal !== 'undefined') {
                        const Toast = Swal.mixin({
                            toast: true, position: 'top-end', showConfirmButton: false, timer: 1500, timerProgressBar: true
                        });
                        Toast.fire({ icon: 'success', title: 'কার্টে যোগ হয়েছে' });
                    } else {
                        alert('কার্টে যোগ হয়েছে');
                    }
                }
            } catch (err) { console.error("Cart Error:", err); }
        }
        function removeFromCart(index) {
            cart.splice(index, 1); localStorage.setItem('cart',
                JSON.stringify(cart)); updateCartUI();
        }
        function updateCartUI() {
            const container = document.getElementById('cart-items-container');
            let total = 0;
            if (cart.length === 0) {
                container.innerHTML = `<div
                    class="flex flex-col items-center justify-center h-full text-gray-400"><i
                        class="fas fa-shopping-basket text-4xl mb-2 opacity-30"></i>
                    <p>ব্যাগ খালি!</p>
                </div>`;
            }
            else {
                container.innerHTML = "";
                cart.forEach((item, index) => {
                    total += parseInt(item.price);
                    container.innerHTML += `<div
                    class="flex gap-3 items-center bg-white p-2.5 rounded-xl border border-gray-100 shadow-sm"><img
                        src="${item.img}" class="w-12 h-12 rounded-lg object-cover bg-gray-100"
                        onerror="this.src='https://via.placeholder.com/50'">
                    <div class="flex-1">
                        <h4 class="font-bold text-xs md:text-sm text-gray-800 line-clamp-1">${item.name}</h4>
                        <p class="theme-text font-bold text-xs md:text-sm">৳${item.price}</p>
                    </div><button onclick="removeFromCart(${index})"
                        class="w-7 h-7 flex items-center justify-center rounded-full bg-red-50 text-red-500"><i
                            class="fas fa-trash-alt text-xs"></i></button>
                </div>`;
                });
            }
            document.getElementById('drawer-total').innerText = '৳' + total;
            document.getElementById('mobile-cart-badge').innerText = cart.length;
            document.getElementById('sticky-count').innerText = cart.length;
            document.getElementById('sticky-total').innerText = '৳' + total;
            const mini = document.getElementById('mini-sticky-cart');
            cart.length > 0 ? mini.classList.remove('opacity-0', 'translate-y-10') : mini.classList.add('opacity-0',
                'translate-y-10');
        }
        function toggleCart() {
            const d = document.getElementById('cart-drawer');
            d.classList.contains('translate-x-full') ? openCart() : closeCart();
        }
        function openCart() {
            document.getElementById('cart-drawer').classList.remove('translate-x-full');
            document.getElementById('cart-overlay').classList.remove('hidden'); document.body.style.overflow =
                'hidden';
        }
        function closeCart() {
            document.getElementById('cart-drawer').classList.add('translate-x-full');
            document.getElementById('cart-overlay').classList.add('hidden'); document.body.style.overflow = 'auto';
        }

        fetchProducts();

        // Rive Loaders
        try {
            const loaderUrl = 'https://cdn.rive.app/animations/vehicles.riv'; // Placeholder for high quality loader
            // Initialize Grid Loader
            const gLoader = new rive.Rive({
                src: loaderUrl,
                canvas: document.getElementById('grid-loader'),
                autoplay: true,
                stateMachines: "bumpy",
                onLoad: () => { gLoader.resizeDrawingSurfaceToCanvas(); }
            });
        } catch (e) { console.error("Rive Error", e); }
    </script>
</body>

</html>